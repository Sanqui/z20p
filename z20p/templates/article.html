{% extends "_base.html" %}

{% block title %}{{article.title}}{% endblock %}
{% block canonical %}{{article.url}}{% endblock %}

{% block content %}
    {{ display_article(article) }}
    <a class="mediatab selectedtab" id="tab-images">Obrázky ({{images|length}})</a><a class="mediatab" id="tab-videos">Videa ({{videos|length}})</a><a class="mediatab" id="tab-upload">Upload</a>
    <div class="mediagallery" id="gallery-images">
        {%- for media in images -%}
            <div class="mediabox" id="media-{{media.id}}">
                <div><a href="{{media.url}}" rel="prettyPhoto[media]" title="<a href='{{media.url}}'>{{media.title}}</a><p><small>{{media.author.name}}, {{media.timestamp|datetime}}</small>"><img src="{{media.thumb}}" class="image" alt="{{media.title}}"></a></div>
                <span title="{{media.author.name}}, {{media.timestamp|datetime}}">{{media.title}}
                <!--{{author(media.author, clip=True)}}-->
                    {% if g.user.admin or (g.user == media.author and not g.user.guest) %}
                        <a href="/media/{{media.id}}/edit">{{icon("pencil", "Edit")}}</a>
                    {% endif %}
                </span>
            </div>
        {%- endfor -%}</div>
    <div class="mediagallery" id="gallery-videos">
        {%- for media in videos -%}
            <div class="mediabox" id="media-{{media.id}}">
<!--TODO stick a large red right arrow over the image to signify it's a VIDEO.-->
                <div><a href="{{media.url}}" rel="prettyPhoto[videos]"><img src="{{media.thumb}}" class="image" alt="Video"></a></div>
                <div title="{{media.author.name}}, {{media.timestamp|datetime}}">{{media.title}}
                    <!--{{author(media.author, clip=True)}}-->
                    {% if g.user.admin or (g.user == media.author and not g.user.guest) %}
                        <a href="/media/{{media.id}}/edit">{{icon("pencil", "Edit")}}</a>
                    {% endif %}
                </div>
            </div>
        {%- endfor -%}</div>
    <div class="mediagallery" id="gallery-upload">
        <div class="leftcolumn">
            <form method="POST" action="{{article.url}}/post#upload" enctype="multipart/form-data">
              <dl>
                {{ render_field(upload_form.image, accept="image/*") }}
                {{ render_field(upload_form.title) }}
                {{ render_field(upload_form.submit) }}
              </dl>
            </form>
        </div>
        <div class="rightcolumn">
            <form method="POST" action="{{article.url}}/post#upload">
              <dl>
                {{ render_field(video_form.url) }}
                {{ render_field(video_form.video_title) }}
                {{ render_field(video_form.submit) }}
              </dl>
            </form>
        </div>
    </div>
    <div id="reactions">
        {% for reaction in article.reactions %}
            {{ display_article(reaction) }}
        {% endfor %}
    </div>
    <div class="rightcolumn">
        <h2>Ohodnotit</h2>
        <form method="POST" action="{{article.url}}/post">
          <dl>
            {{ render_field(rating_form.rating) }}
            {{ rating_form.submit() }}
          </dl>
        </form>
        {% if g.user.admin %} 
            <h2>Čtenářská hodnocení</h2>
            (vidí jen admini)
            <ul>
                {% for rating in article.ratings %}
                    <li>{{rating.rating}}/10 - {{author(rating.user)}}
                {% endfor %}
            </ul>
        {% endif %}
    </div>
    <div class="leftcolumn">
        <h2>Napsat reakci</h2>
        <form method="POST" action="{{article.url}}/post" enctype="multipart/form-data">
          <dl>
            {% if g.user.guest %} {{ render_field(reaction_form.name) }} {% endif %}
            {{ render_field(reaction_form.text) }}
            {% if g.user != article.author %} {{ render_field(reaction_form.rating) }} {% endif %}
            {{ render_field(reaction_form.image, accept="image/*") }}
            {{ render_field(reaction_form.title) }}
            {{ reaction_form.submit() }}
          </dl>
        </form>
    </div>
{% endblock %}
