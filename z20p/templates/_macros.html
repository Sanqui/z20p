## REMEMBER TO ADD AN IMPORT TO _base.html
{% macro render_field(field) %}
  <dt>{% if field.name != "submit" %}{{ field.label }}{% endif %}
  <dd>{{ field(**kwargs)|safe }}
  {% if field.errors %}
    <ul class=errors>
    {% for error in field.errors %}
      <li>{{ error }}</li>
    {% endfor %}
    </ul>
  {% endif %}
  </dd>
{% endmacro %}
{% macro td_field(field) %}
  <td title="{{field.name}}">{{ field(**kwargs)|safe }}
  {% if field.errors %}
    <ul class=errors>
    {% for error in field.errors %}
      <li>{{ error }}</li>
    {% endfor %}
    </ul>
  {% endif %}
  </td>
{% endmacro %}
## TODO rename to render_article
{% macro display_article(article, crop=False, cut=False) -%}
    <article class="{{'crop' if crop else 'regular'}}" id="{{'article' if article.is_article else 'reaction'}}-{{article.id}}">
        {% if article.media %}
            {% if crop %} <a href="{{article.url}}">
            {% else %} <a href="{{article.media.url}}" rel="prettyPhoto" title="{{article.media.title}}">{% endif %}
            <img src="{{article.media.url}}" title="{{article.media.title}}" alt="{{article.title}}" class="image">
            </a>
        {% endif %}
        {% if article.rating %}
            <div class="ratingbox">
                <span class="rating">{{ article.rating.rating }}</span>
                {%- if article.rating.rating != 10 -%}
                    <span class="outof">/10</span>
                {%- endif -%}
            </div>
        {% endif %}
        {% if article.title %}
            <h1><a href="{{article.url}}">{{ article.title }}</a></h1>
        {% endif %}
        {% if not crop %}
            <p>{{article.text|replace("\n", "\n<p>")|safe}}
        {% else %}
            <ul class="platforms">
            {% for label in article.labels %}
                {% if label.category == 'platform' %}
                    <li><a href="{{label.url}}">{{label.name}}</a>
                {% endif %}
            {% endfor %}
            </ul>
        {% endif %}
            {% if cut or crop %}
                {{icon("images-stack", "Obrázků")}}×{{ article.all_media|count }} {{icon("blogs-stack", "Reakcí")}}×{{ article.reactions|count }}
            {% endif %}
        <footer>
            <div class="dateline">{{icon("calendar-blue", "Datum publikace:")}} {{article.timestamp|datetime}}</div> 
            <ul class="labels">
                {% for label in article.labels %}
                    <li><a href="{{label.url}}">{{label.name}}</a>
                {% endfor %}
            </ul>
            <div class="authorline">Napsal{{gr(article.author.gender)}}: {{author(article.author)}}</div>       
            {% if g.user.admin or g.user == article.author %}<div class="adminline"><a href="{{article.url}}/edit">{{icon("pencil", "Editovat")}}</a></div>{% endif %}
            <div style="clear:both;"></div>  
        </footer>        
    </article>
{%- endmacro %}
## This isn't very pretty!  We should get url_args and url elsewhere.
{% macro render_pages(page, count, url_args, per_page=5) %}
    <p>Stránka {{ page }} z {{ (count//per_page)+1 }}
    <p>
        {%- for p in range(1, (count//per_page)+2) -%}
            {%- if p == page -%}
                <strong>{{p}}</strong>{{"," if not loop.last else ""}}
            {% else -%}
                <a href='{{url_for_here(page=p)}}'>{{p}}</a>{{"," if not loop.last else ""}}
            {% endif %}
        {% endfor %}
{% endmacro %}
{% macro render_buttons(buttons) %}
    {% for button in buttons %}
        {% if button.labels %}
            <li><span class="down" id="down-{{button.id}}">▼</span><a href="{{button.search_url}}">{{button.name}}</a>
                <ul class="button-labels" style="display: none;" id="button-{{button.id}}-labels">
                    {% for label in button.labels %}
                        <li><a href="{{label.label.url}}">{{label.label.name}}</a>
                    {% endfor %}
                </ul>
        {% else %}
            <li><a href="{{button.url}}">{{icon(button.icon, button.name)+" " if button.icon}}{{button.name}}{{" <strong>({0})</strong>".format(g.unread)|safe if g.unread and button.name == "Shoutbox"}}</a>
        {% endif %}
    {% endfor %}
{% endmacro %}
{% macro icon(name, alt, title="") -%}
<img src="{{'/static/icons/'+name+'.png' if '/' not in name else name}}" alt="{{alt}}" title="{{alt if title=='' else title}}" class="icon" width=16 height=16>
{%- endmacro %}
{% macro author(user) -%}
<author><a href="{{user.url if (not user.guest or g.user.admin) else '#'}}" class="iconlink">{{icon(user.minipic, user.name)+" " if user.minipic}}</a><a href="{{user.url if (not user.guest or g.user.admin) else '#'}}">{{user.name}}</a>{{'★' if not user.guest}}</author>
{%- endmacro %}
## This really needs some more thinking through... # Also crap g is the global variable.
{% macro gr(gender=None) -%}
{{{'m':'', 'f':'a', '-':'o'}[gender if gender else g.user.gender]}}
{%- endmacro %}
